@{
    ViewData["Title"] = "Krijo Shërbim";
}

<h2>Krijo Shërbim të Ri</h2>

<form id="createServiceForm" enctype="multipart/form-data">
    <!-- Hidden input për CategoryId -->
    <input type="hidden" id="categoryId" value="@ViewBag.CategoryId" />

    <div class="form-group">
        <label for="name">Emri</label>
        <input type="text" id="name" name="name" class="form-control" required />
    </div>

    <div class="form-group mt-3">
        <label for="description">Përshkrimi</label>
        <textarea id="description" name="description" class="form-control"></textarea>
    </div>

    <div class="form-group mt-3">
        <label for="price">Çmimi (€)</label>
        <input type="number" id="price" name="price" class="form-control" step="0.01" required />
    </div>

    <div class="form-group mt-3">
        <label for="image">Ngarko Imazh</label>
        <input type="file" id="image" name="image" class="form-control" accept="image/*" required />
    </div>

    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Krijo</button>
        <a href="/Home/Index" class="btn btn-secondary">Anulo</a>
    </div>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $('#createServiceForm').submit(function (e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append("name", $('#name').val());
            formData.append("description", $('#description').val());
            formData.append("price", $('#price').val());
            formData.append("categoryId", $('#categoryId').val());

            const imageFile = $('#image')[0].files[0];
            if (imageFile) {
                formData.append("image", imageFile);
            }

            $.ajax({
                url: '/api/Service',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function () {
                    alert("Shërbimi u krijua me sukses!");
                    window.location.href = `/Service1/Service/${$('#categoryId').val()}`;
                },
                error: function (xhr) {
                    alert("Gabim gjatë krijimit të shërbimit:\n" + xhr.responseText);
                }
            });
        });
    </script>
}
